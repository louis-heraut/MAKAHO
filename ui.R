# \\\
# Copyright 2022 Louis HÃ©raut*1
#
# *1   INRAE, France
#      louis.heraut@inrae.fr
#      https://github.com/super-lou
#
# This file is part of sht R toolbox.
#
# Sht R toolbox is free software: you can redistribute it and/or
# modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.
#
# Sht R toolbox is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with sht R toolbox.
# If not, see <https://www.gnu.org/licenses/>.
# ///
#
#
# ui.R


ui = bootstrapPage(

    useShinyjs(),
    
    tags$head(HTML("<title>MAKAHO</title> <link rel='icon' type='image/gif/png' href='MAKAHO.png'>")),

    tags$head(tags$script('
    var dimension = [0, 0];
    $(document).on("shiny:connected", function(e) {
        dimension[0] = window.innerWidth;
        dimension[1] = window.innerHeight;
        Shiny.onInputChange("dimension", dimension);
    });
    $(window).resize(function(e) {
        dimension[0] = window.innerWidth;
        dimension[1] = window.innerHeight;
        Shiny.onInputChange("dimension", dimension);
    });')),
    
## 1. MAP ____________________________________________________________
### 1.1. Background __________________________________________________    
    tags$style(type="text/css",
               "html, body {width: 100%; height: 100%}"),
    tags$head(tags$style(
                       ".leaflet-control-easyPrint.leaflet-bar.leaflet-control
                   {display: none;}")),

    includeCSS("www/ui.css"),
    
    tags$body(
             
             div(id='mapPreview_div',
                 style="position: absolute;
                             top: 0; bottom: 0; left: 0; right: 0;",
                 leafletOutput("mapPreview", width="100%",
                                    height="100%")),
             
             div(id='map_div',
                 style="position: absolute;
                             top: 0; bottom: 0; left: 0; right: 0;",
                 leafletOutput("map", width="100%",
                               height="100%")),
             ),


## 6. HELP ___________________________________________________________
    hidden(
        fixedPanel(id='help_panelButton',
                   right=95, bottom=8,
                   width="auto", height="auto",
                   Button(class="Button-icon",
                          inputId='help_button',
                          label=NULL,
                          icon_name=iconLib$help_outline_grey,
                          tooltip=word("tt.help"))
                   )
    ),

    hidden(
        fixedPanel(id='blur_panel',
                   class="Panel card-blur"   
        )
    ),
    

### 1.2. Zoom ________________________________________________________
    hidden(
        fixedPanel(id='focusZoom_panelButton',
                   left=10, top=10,
                   width="auto", height="auto",
                   Button(class="SmallButton-menu",
                          inputId='focusZoom_button',
                          label=NULL,
                          icon_name=iconLib$focus_white,
                          tooltip=word("tt.z.focus"))
                   )
    ),
    
    hidden(
        fixedPanel(id='defaultZoom_panelButton',
                   left=10, top=10,
                   width="auto", height="auto",
                   Button(class="SmallButton-menu",
                          inputId='defaultZoom_button',
                          label=NULL,
                          icon_name=iconLib$default_white,
                          tooltip=word("tt.z.default"))
                   )
    ),

    
## 2. ANALYSE ________________________________________________________
### 2.1. Panel button ________________________________________________
    fixedPanel(left=10, bottom=10,
               width="auto", height="auto",
               Button(class="Button-menu",
                      inputId='ana_button',
                      label=HTML(paste0("<b>",
                                        word("ana.title"),
                                        "</b>")),
                      icon_name=iconLib$show_chart_white,
                      tooltip=word("tt.ana.title"))
               ),
    
### 2.2. Panel _______________________________________________________
    hidden(
        absolutePanel(
            id='ana_panel',
            class="Panel card",
            fixed=TRUE,
            width=460, height="auto",
            left=10, bottom=49,

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("ana.data"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    textOutput("data"))),

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("ana.date"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    textOutput("period"))),
            
### 2.3. Station selection ___________________________________________
            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("ana.selec"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    
                    Button(class="Button",
                           'all_button',
                           label=word("ana.selec.all"),
                           icon_name=iconLib$check_circle_white,
                           tooltip=word("tt.ana.selec.all")),
                    
                    Button(class="Button",
                           'none_button',
                           label=word("ana.selec.none"),
                           icon_name=iconLib$cross_circle_white,
                           tooltip=word("tt.ana.selec.none")),
                    
                    selectButton(
                        class="selectButton",
                        inputId="click_select",
                        label=word("ana.selec.click"),
                        icon_name=iconLib$click_white,
                        selected=FALSE,
                        tooltip=word("tt.ana.selec.click")),

                    selectButton(
                        class="selectButton",
                        inputId="poly_select",
                        label=word("ana.selec.poly"),
                        icon_name=iconLib$polyline_white,
                        selected=FALSE,
                        tooltip=word("tt.ana.selec.poly")),

                    selectButton(
                        class="selectButton",
                        inputId="warning_select",
                        label=word("ana.selec.warning"),
                        icon_name=iconLib$error_outline_white,
                        selected=TRUE,
                        tooltip=word("tt.ana.selec.warning")),
  
                    selectizeInput(inputId="search_input", 
                                   label=NULL,
                                   multiple=TRUE,
                                   choices=NULL),
                    )),

### 2.4. Variable selection __________________________________________
            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word('ana.regime'),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    radioButton(
                        class="radioButton",
                        inputId="event_choice",
                        choiceNames=rle(Var$event)$values,
                        selected=rle(Var$event)$values[1],
                        choiceTooltips=
                            paste(word("tt.ana.regime"),
                                  tolower(rle(Var$event)$values))))),
            
            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word('ana.var'),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    radioButton(class="radioButton",
                                inputId="var_choice",
                                choices=FALSE,
                                selected=NULL))),

            hidden(
                div(class="Row", id="proba_row",
                    div(class="row-label",
                        HTML(paste0("<span><b>",
                                    word('ana.proba'),
                                    "</b></span>"))),
                    div(class="sep"),
                    div(class="bunch",
                        radioButton(class="radioButton",
                                    inputId="proba_choice",
                                    choices=FALSE,
                                    selected=NULL)))),

### 2.5. Period selection ____________________________________________
            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word('ana.dm'),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch textSlider",
                    sliderTextInput(inputId="dateMonth_slider",
                                    label=NULL,
                                    grid=TRUE,
                                    force_edges=FALSE,
                                    choices=Months))),

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word('ana.dy'),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    sliderInput("dateYear_slider",
                                label=NULL,
                                step=1,
                                sep='',
                                min=1900,
                                max=2020,
                                value=c(1968, 2020)))),

### 2.6. Statistical option ______________________________________________
            div(class="Row",
                div(class="row-label",
                    HTML(
                        paste0("<span><b>",
                               word("ana.sig"),
                               "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    radioButton(class="radioButton",
                                inputId="alpha_choice",
                                choiceValues=sigVal,
                                choiceNames=sigProba,
                                choiceTooltips=
                                    paste(word("tt.ana.sig.p"),
                                          sigProba),
                                selected=sigVal[3])))
        )
    ),

#### 2.3.1. Click bar ________________________________________________
    hidden(
        absolutePanel(
            id='click_bar',
            class="Panel smallCard",
            fixed=TRUE,        
            width="auto", height="auto",
            left=46, top=8,

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("click.bar"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    Button(class="Button",
                           'clickOk_button',
                           label=word("bar.ok"),
                           icon_name=iconLib$done_white,
                           tooltip=word("tt.bar.ok")))),
            )
     ),

#### 2.3.2. Poly bar _________________________________________________
     hidden(
        absolutePanel(
            id='poly_bar',
            class="Panel smallCard",
            fixed=TRUE,        
            width="auto", height="auto",
            left=46, top=8,

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("poly.bar"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    radioButton(class="radioButton",
                                inputId="poly_choice",
                                choiceValues=list("Add",
                                                  "Rm"),
                                choiceIcons=list(iconLib$add_white,
                                                 iconLib$remove_white),
                                choiceNames=list(word("poly.bar.Add"),
                                                 word("poly.bar.Rm")),
                                choiceTooltips=list(word("tt.poly.bar.Add"),
                                                    word("tt.poly.bar.Rm")),
                                selected="Add"),
                    
                    Button(class="Button",
                           'polyOk_button',
                           label=word("bar.ok"),
                           icon_name=iconLib$done_white,
                       tooltip=word("tt.bar.ok")))),
            )
     ),

### 2.7. Trend plot __________________________________________________
    hidden(
        absolutePanel(
            id='plot_panel',
            style=CSSpanel_plot,
            fixed=TRUE,
            draggable=TRUE,
            width=520, height=220,
            left=0, bottom=10, right=0,
            
            div(style="position: absolute;
                            margin-bottom: 10px; margin-top: 10px;
                            margin-left: 10px; margin-right: 10px;",
                plotOutput("trend_plot")),
            
            div(Button(class="Button-icon",
                       style="position: absolute;
                              top: 0.15rem;
                              left: 0.15rem;",
                       inputId='closePlot_button',
                       label=NULL,
                       icon_name=iconLib$close_black))
        )
    ),

    

## 3. CUSTOMIZATION __________________________________________________
### 3.1. Panel button ________________________________________________
    fixedPanel(left=116, bottom=10,
               width="auto", height="auto",
               Button(class="Button-menu",
                      inputId='theme_button',
                      label=NULL,
                      icon_name=iconLib$menu_white,
                      tooltip=word("tt.c.title"))
               ),
    
### 3.2. Panel _______________________________________________________
    hidden(
        absolutePanel(
            id='theme_panel',
            class="Panel card",
            fixed=TRUE,        
            width="auto", height="auto",
            left=116, bottom=49,
            
### 3.2. Background theme ____________________________________________
            div(class="Row",
                div(class="row-label",
                    HTML(
                        paste0("<span><b>",
                               word("c.theme"),
                               "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    radioButton(class="radioButton",
                                inputId="theme_choice",
                                choiceValues=list("light",
                                                  "terrain",
                                                  "dark"),
                                choiceIcons=
                                    list(iconLib$light_white,
                                         iconLib$terrain_white,
                                         iconLib$dark_white),
                                choiceNames=
                                    list(word("c.theme.light"),
                                         word("c.theme.terrain"),
                                         word("c.theme.dark")),
                                choiceTooltips=
                                    list(word("tt.c.theme.light"),
                                         word("tt.c.theme.terrain"),
                                         word("tt.c.theme.dark"))))),
            
### 3.3. Palette button ______________________________________________
            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("c.cb"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    radioButton(class="radioButton",
                                inputId="colorbar_choice",
                                choiceNames=
                                    list(word("c.cb.show"),
                                         word("c.cb.none")),
                                choiceValues=
                                    list("show", "none"),
                                selected="none")))
            
        )
    ),

    hidden(
        absolutePanel(
            id="colorbar_panel",
            style=CSSpanel_colorbar,
            fixed=TRUE,
            width=75, height=270,
            right=0, top=0, bottom=0,
            tags$div(style="margin-bottom: 10px; margin-top: 10px;
                            margin-left: 10px; margin-right: 10px;",
                     plotOutput("colorbar_plot"))
        )
    ),

    
## 4. INFO ___________________________________________________________
### 4.1. Panel button ________________________________________________ 
    fixedPanel(right=10, bottom=2,
               width="auto", height="auto",
               Button(class="Button-info",
                      inputId='info_button',
                      label=NULL,
                      icon_name=iconLib$INRAElogo,
                      tooltip=word("tt.i.title"))
               ),
    
### 4.2. Panel _______________________________________________________
    hidden(
        absolutePanel(
            id='info_panel',
            class="Panel card",
            fixed=TRUE,
            width="auto", height="auto",
            right=10, bottom=40,

### 4.3. Contact info ________________________________________________
            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("i.dev"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    a(href="mailto:louis.heraut@inrae.fr",
                      "Louis HÃ©raut"))),

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("i.ref"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    a(href="mailto:michel.lang@inrae.fr",
                      "Michel Lang"))),

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("i.sk8"),
                                "</b></span>"))),
                div(class="sep"),
                div(a(href="https://sk8.inrae.fr",
                      img(src="SK8.png", height="17px"))),
                div(style="padding-top: 3px; padding-left: 5px;",
                    a(href="https://sk8.inrae.fr",
                      "SK8"))),

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("i.ui"),
                                "</b></span>"))),
                div(class="sep"),
                div("inspirÃ©e de ",
                    a(href="https://earth.nullschool.net/",
                      "earth.nullschool.net")))
        )
    ),

    
## 5. SAVE ___________________________________________________________
### 5.1. Screenshot __________________________________________________
    fixedPanel(right=10, top=10,
               width="auto", height="auto",
               Button(class="SmallButton-menu",
                      inputId='photo_button',
                      label=NULL,
                      icon_name=iconLib$photo_white,
                      tooltip=word("tt.p.title"))
               ),

    hidden(
        absolutePanel(
            id='photo_panel',
            class="Panel card",
            fixed=TRUE, 
            width="auto", height="auto",
            right=45, top=10,

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("p.format"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",

                    Button(class="Button",
                           inputId="photoA4l_button",
                           label=word("p.format.A4l"),
                           icon_name=iconLib$crop_landscape_white,
                           tooltip=word("tt.p.format.A4l")),

                    Button(class="Button",
                           inputId="photoA4p_button",
                           label=word("p.format.A4p"),
                           icon_name=iconLib$crop_landscape_white,
                           tooltip=word("tt.p.format.A4p"))))
        )
    ),
    
### 5.2. Download ____________________________________________________
    fixedPanel(right=10, top=45,
               width="auto", height="auto",
               Button(class="SmallButton-menu",
                      inputId='download_button',
                      label=NULL,
                      icon_name=iconLib$download_white,
                      tooltip=word("tt.d.title"))
               ),

    downloadLink("downloadData", label=""),
    tags$head(tags$script(HTML('Shiny.addCustomMessageHandler("jsCode",
                                function(message) {
                                eval(message.value);});'))),

    hidden(
        absolutePanel(
            id='download_panel',
            class="Panel card",
            fixed=TRUE,
            width="auto", height="auto",
            right=45, top=45,

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("d.dl"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",

                    selectButton(class="selectButton",
                                 inputId="dlClick_select",
                                 label=word("d.click"),
                                 icon_name=iconLib$click_white,
                                 selected=FALSE,
                                 tooltip=word("tt.d.click")),

                    Button(class="Button",
                           inputId="dlSelec_button",
                           label=word("d.selec"),
                           icon_name=iconLib$scatter_plot_white,
                           tooltip=word("tt.d.selec")),

                    Button(class="Button",
                           inputId="dlAll_button",
                           label=word("d.all"),
                           icon_name=iconLib$check_circle_white,
                           tooltip=word("tt.d.all"))))
        )
    ),

    hidden(
        absolutePanel(
            id='dlClick_bar',
            class="Panel smallCard",
            fixed=TRUE, 
            width="auto", height="auto",
            left=46, top=8,

            div(class="Row",
                div(class="row-label",
                    HTML(paste0("<span><b>",
                                word("dl.bar"),
                                "</b></span>"))),
                div(class="sep"),
                div(class="bunch",
                    Button(class="Button",
                           'dlClickOk_button',
                           label=word("bar.ok"),
                           icon_name=iconLib$done_white,
                           tooltip=word("tt.bar.ok"))))
        )
    ),




## 6. HELP ___________________________________________________________
### 6.2. Opaque panel ________________________________________________



    # /!\ Ã REPRENDRE POUR CHAQUE BOUTON AVEC LE MASK

    
    # hidden( 
    #     fixedPanel(id='opaque_panel',
    #                class="Panel card-opaque"   
    #                )
    # ),

### 6.3. Button mask ________________________________________________
    hidden(
        fixedPanel(id='maskZoom_panelButton',
                   left=10, top=10,
                   width="auto", height="auto",
                   Button(class="maskSmallButton-menu",
                          inputId='mask',
                          label=NULL,
                          icon_name=iconLib$none)
                   )
    ),
    
    hidden(
        fixedPanel(id='maskAna_panelButton',
                   left=10, bottom=10,
                   width="auto", height="auto",
                   Button(class="maskButton-menu",
                          inputId='mask',
                          label=HTML(paste0("<b>",
                                            word("ana.title"),
                                            "</b>")),
                          icon_name=iconLib$none)
                   )
    ),

    hidden(
        fixedPanel(id="maskTheme_panelButton",
                   left=116, bottom=10,
                   width="auto", height="auto",
                   Button(class="maskButton-menu",
                          inputId='mask',
                          label=NULL,
                          icon_name=iconLib$none)
                   )
    ),

    hidden(
        fixedPanel(id="maskInfo_panelButton",
                   right=10, bottom=2,
                   width="auto", height="auto",
                   Button(class="maskButton-info",
                          inputId='mask',
                          label=NULL,
                          icon_name=iconLib$noneINRAElogo)
                   )
       ),
    


    hidden(
        fixedPanel(id="maskPhoto_panelButton",
                   right=10, top=10,
                   width="auto", height="auto",
                   Button(class="maskSmallButton-menu",
                          inputId='mask',
                          label=NULL,
                          icon_name=iconLib$none)
                   )
    ),

    hidden(
        fixedPanel(id="maskDownload_panelButton",
                   right=10, top=45,
                   width="auto", height="auto",
                   Button(class="maskSmallButton-menu",
                          inputId='mask',
                          label=NULL,
                          icon_name=iconLib$none)
               )
    ),

### 6.4. Pages _______________________________________________________
#### 6.4.1. Page 1 ___________________________________________________
    page_circle(n=1, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),
    
    hidden(
        fixedPanel(id="help1_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(style="font-size: 4em;",
                      HTML(
                       "<b>MAKAHO</b>"
                   )),
                   
                   p(HTML(
                       "MAKAHO (pour MAnn-Kendall Analysis of Hydrological Observations) est un systÃ¨me de <b>visualisation cartographique interactif</b> permettant dâexaminer les <b>tendances</b> prÃ©sentes dans les donnÃ©es des <b>stations hydromÃ©triques aux dÃ©bits peu influencÃ©s</b> par les actions humaines. Le test de <b>Mann-Kendall</b> permet dâanalyser la significativitÃ© des tendances de variables hydrologiques sur les diffÃ©rentes composantes du rÃ©gime des cours d'eau (Ã©tiages, moyennes-eaux, crues), Ã  mettre ensuite en relation avec les impacts du <b>changement climatique</b> sur lâhydrologie de surface."
                   ))
                   )
    ),

#### 6.4.2. Page 2 ___________________________________________________
    page_circle(n=2, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),

    hidden(
        fixedPanel(id="help2_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>FOND DE CARTE</b>"
                   )),

                   h4(HTML(
                       "<b>STRUCTURE</b>"
                   )),
                   
                   p(HTML(
                       "Lâinterface de MAKAHO se concentre autour dâune <b>carte Leaflet interactive</b>. Le planisphÃ¨re est recouvert de cercles et de triangles de couleur diffÃ©rentes qui permettent de situer les stations hydromÃ©triques et de donner une idÃ©e de lâintensitÃ© de la tendance estimÃ©e. Un <b>cercle</b> indique que la tendance nâest <b>pas significative</b> alors quâun triangle indique que la tendance est significative. Un <b>triangle pointant vers le haut</b> indique que la tendance est Ã  la <b>hausse</b> alors quâun <b>triangle dont la pointe est vers le bas</b> indique une tendance Ã  la <b>baisse</b>."
                   ))
                   )
    ),

#### 6.4.3. Page 3 ___________________________________________________
    page_circle(n=3, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),

    hidden(
        fixedPanel(id="help3_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>FOND DE CARTE</b>"
                   )),
                   
                   h4(HTML(
                       "<b>INTERACTION</b>"
                   )),
                   
                   p(HTML(
                       "Le fond de carte est interactif, cela veut dire quâil est possible de se <b>dÃ©placer</b> sur le planisphÃ¨re en effectuant un <b>click gauche glisser</b>. De la mÃªme maniÃ¨re, il est aussi possible de <b>zoomer</b> en effectuant un <b>roulement de la molette de souris</b>."
                   )),

                   p(HTML(
                       "Les <b>cercles et triangles</b> sont aussi cliquables. Par dÃ©faut, le <b>clic</b> sur une station permet dâafficher le <b>graphique dÃ©taillÃ© de lâanalyse de tendance</b> de la variable Ã©tudiÃ©e."
                   ))
                   )  
    ),
    
#### 6.4.4. Page 4 ___________________________________________________
    page_circle(n=4, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),

    hidden(
        fixedPanel(id="help4_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>ZOOM</b>"
                   )),
                   
                   p(HTML(
                       "Les interactions avec le fond de carte font apparaÃ®tre le <b>bouton de zoom en haut Ã  gauche</b> qui permet de reâfaire le <b>focus</b> sur lâensemble des stations sÃ©lectionnÃ©es. Ainsi, si la sÃ©lection de station est rÃ©duite, ce mÃªme bouton peut apparaÃ®tre afin de laisser la possibilitÃ© Ã  lâutilisateur de laisser lâapplication choisir le zoom et le <b>positionnement de carte le plus adaptÃ©</b>. Lorsque le positionnement est optimale sur une sÃ©lection, un bouton de zoom diffÃ©rent apparaÃ®t Ã  la mÃªme place. Ce nouveau bouton permet alors de <b>reâfaire le focus</b> non pas sur la sÃ©lection de station mais <b>sur la France</b> entiÃ¨re."
                   )),

                   p(HTML(
                       "Le mieux c'est d'essayer !"
                   ))
                   )
    ),

#### 6.4.5. Page 5 ___________________________________________________
    page_circle(n=5, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),

    hidden(
        fixedPanel(id="help5_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>ANALYSE</b>"
                   )),

                   h4(HTML(
                       "<b>SÃLECTION</b>"
                   )),
                   
                   p(HTML(
                       "Les deux premiers boutons de la section de sÃ©lection permettent respectivement de sÃ©lectionner <b>toutes</b> les stations ou <b>aucunes</b>."
                   )),

                   p(HTML(
                       "Le troisiÃ¨me bouton de la ligne est le bouton de <b>sÃ©lection par clic</b> sur la carte. Une fois ce mode activÃ©, un clic sur le symbole dâune station permet de <b>changer son Ã©tat de sÃ©lection</b>. Lors du lancement de ce mode, une <b>barre d'outil</b> apparaÃ®t en haut Ã  gauche et permet de terminer la sÃ©lection par clic."
                   )),
                   
                   p(HTML(
                       "Le quatriÃ¨me bouton correspond au bouton de <b>sÃ©lection par polygone</b> sur la carte. Un polygone peut donc Ãªtre tracÃ© en plaÃ§ant des points sur la carte. Comme dans le mode prÃ©cÃ©dent, une <b>barre d'outil</b> apparaÃ®t en haut Ã  gauche de lâinterface et permet de rendre la sÃ©lection par polygone additive ou soustractive."
                   )),
                   )
    ),


    # Une fois la sÃ©lection rÃ©alisÃ©e, les stations nonâsÃ©lectionnÃ©es sont reprÃ©sentÃ©es par un cercle neutre / . Les stations prÃ©sentes dans la sÃ©lection sont localisÃ©es par un cercle ou un triangle / de couleur.


    
#### 6.4.6. Page 6 ___________________________________________________
    page_circle(n=6, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),

    hidden(
        fixedPanel(id="help6_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>ANALYSE</b>"
                   )),

                   h4(HTML(
                       "<b>SÃLECTION</b>"
                   )),
                   
                   p(HTML(
                       "Le bouton <b>avertissement</b> est prÃ©sent sur la seconde ligne. Lorsqu'il est sÃ©lectionnÃ©, comme par dÃ©faut, les stations qui prÃ©sentent des <b>chroniques de moins de 30 ans</b> sont situÃ©es des symboles au <b>contour jaune</b> et lorsque les chroniques sont complÃ¨tement <b>manquantes</b>, les symboles utilisÃ©s sont des cercles au <b>contour rouge</b>. Dans le cas oÃ¹ le bouton est dÃ©selectionnÃ©, les stations qui prÃ©sentent des avertissements sont <b>retirÃ©es automatiquement</b> de la sÃ©lection."
                   )),

                   p(HTML(
                       "Enfin, la sÃ©lection peut se faire Ã  l'aide d'une <b>barre de recherche textuelle</b> avec complÃ©tion automatique. Des stations peuvent Ãªtre sÃ©lectionnÃ©es Ã  lâaide de <b>mots clÃ©s</b> contenus dans leur nom, le nom de leur cours dâeau, le lieu oÃ¹ elles sont situÃ©es de mÃªme que leur rÃ©gionâhydrographique et bassinâhydrographique. Ce mode de sÃ©lection est <b>additif</b> et il est possible dâajouter ou de supprimer plusieurs recherches textuelles."
                   )),
                   )
    ),

    
#### 6.4.7. Page 7 ___________________________________________________
    page_circle(n=7, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),

    hidden(
        fixedPanel(id="help7_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>ANALYSE</b>"
                   )),
                   
                   h4(HTML(
                       "<b>RÃGIME ET VARIABLE</b>"
                   )),
                   
                   p(HTML(
                       "La sÃ©lection de la <b>variable hydrologique utilisÃ©e pour l'analyse de tendance</b> s'effectue Ã  l'aide des sections RÃ©gime et Variable."
                   )),

                   p(HTML(
                       "La sÃ©ction <b>RÃ©gime</b> permet de sÃ©lectionner la composantes du <b>rÃ©gime des cours d'eau</b> que l'on souhaite Ã©tudiÃ© : <b>Crue</b>, <b>Crue Nivale</b>, <b>Moyennes Eaux</b> ou <b>Ãtiage</b>. Chaque bouton permet d'afficher un panel de variables caractÃ©ristiques de l'Ã©tude du rÃ©gime choisi."
                   )),

                   p(HTML(
                       "La sÃ©ction <b>Variable</b> permet dans un second temps de sÃ©lectionner la <b>variable que l'on souhaite Ã©tudier</b>."
                   )),
                   )
    ),

#### 6.4.8. Page 8 ___________________________________________________
    page_circle(n=8, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),

    hidden(
        fixedPanel(id="help8_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>ANALYSE</b>"
                   )),
                   
                   h4(HTML(
                       "<b>ANNÃE HYDROLOGIQUE ET PÃRIODE</b>"
                   )),
                   
                   p(HTML(
                       "Lâanalyse de tendance prÃ©sente deux <b>paramÃ¨tres temporels</b> qui sont sÃ©lectionnÃ©s grÃ¢ce aux section <b>AnnÃ©e Hydrologique</b> et <b>PÃ©riode</b>."
                   )),

                   p(HTML(
                       "Le premier paramÃ¨tre est le <b>mois de dÃ©but de lâAnnÃ©e Hydrologique</b> qui par dÃ©faut est fixÃ© sur le mois de janvier. Ce choix se fait Ã  lâaide dâun <b>curseur horizontal simple</b>."
                   )),

                   p(HTML(
                       "Le second aspect temporel est le choix de <b>la pÃ©riode dâanalyse de tendance</b>. Cette sÃ©lection se fait avec <b>un double curseur horizontal</b> qui permet de choisir une date de dÃ©but et de fin de la pÃ©riode dâanalyse. LâannÃ©e de fin est incluse et <b>par dÃ©faut</b> la pÃ©riode temporelle sâÃ©tend de lâannÃ©e <b>1968</b> Ã  <b>2020</b>."
                   )),
                   ) 
    ),

#### 6.4.9. Page 9 ___________________________________________________
    page_circle(n=9, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),
    
    hidden(
        fixedPanel(id="help9_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>ANALYSE</b>"
                   )),
                   
                   h4(HTML(
                       "<b>SIGNIFICATIVITÃ</b>"
                   )),
                   
                   p(HTML(
                       "La derniÃ¨re section correspond au seuil de <b>significativitÃ© du test statistique de MannâKendall</b>, câestâÃ âdire <b>la probabilitÃ© avec laquelle on accepte de se tromper</b> sur lâaffirmation de lâexistence dâune tendance. Le choix de ce seuil est fait Ã  lâaide de boutons qui permettent de sÃ©lectionner la valeur de <b>1%</b>, <b>5%</b> ou <b>10%</b>. Par dÃ©faut, la valeur de <b>10%</b> est sÃ©lectionnÃ©e ce qui sâavÃ¨re Ãªtre la valeur la moins contraignante."
                   ))
                   )
    ),

#### 6.4.10. Page 10 _________________________________________________
    page_circle(n=10, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),

    hidden(
        fixedPanel(id="help10_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>PERSONNALISATION</b>"
                   )),

                   h4(HTML(
                       "<b>FOND DE CARTE</b>"
                   )),
                   
                   p(HTML(
                       "Trois <b>thÃ¨mes de couleur</b> sont disponible pour personnalisÃ© le <b>fond de carte</b> : un thÃ¨me <b>Clair</b>, un thÃ¨me en couleur appelÃ© <b>Terrain</b> qui reprÃ©sente les reliefs et un thÃ¨me <b>Sombre</b>. Le thÃ¨me par <b>dÃ©faut</b> est le thÃ¨me <b>Clair</b>."
                   )),

                   h4(HTML(
                       "<b>ÃCHELLE DE COULEUR</b>"
                   )),
                   
                   p(HTML(
                       "Il est aussi possible dâafficher ou non sur lâinterface l'<b>Ã©chelle de couleur des tendances</b>. Cette Ã©chelle est <b>Ã©volutive</b> en fonction de la <b>sÃ©lection de stations</b> et associe une couleur <b>marron</b> Ã  une <b>tendance nÃ©gative</b> et <b>turquoise</b> Ã  une tendance <b>positive</b>. Plus prÃ©cisÃ©ment, ... ."
                   )),
                   )
    ),

#### 6.4.11. Page 11 _________________________________________________
    page_circle(n=11, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),
    
    hidden(
        fixedPanel(id="help11_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>PRODUCTION DE CARTE</b>"
                   )),
                   
                   p(HTML(
                       "Il est possible de <b>tÃ©lÃ©charger lâÃ©tat de la carte</b> en cliquant sur le format souhaitÃ©. La carte obtenu en <b>png</b> inclue lâ<b>Ã©chelle de couleur</b> lorsquâelle est affichÃ©e mais masque le reste de lâinterface."
                   ))
                   )
    ),

#### 6.4.12. Page 12 _________________________________________________
    page_circle(n=12, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),
    
    hidden(
        fixedPanel(id="help12_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>TÃLÃCHARGEMENT DE FICHES STATIONS</b>"
                   )),
                   
                   p(HTML(
                       "Il est possible de <b>tÃ©lÃ©charger des fiches stations</b> rÃ©capitulative de l'analyse de tendance. Le premier bouton est le bouton de <b>tÃ©lÃ©chargement par clic</b> sur la carte. Une fois ce mode activÃ©, un clic sur le symbole dâune station permet de <b>tÃ©lÃ©charger la fiche station</b> associÃ©e. Lors du lancement de ce mode, une <b>barre d'outil</b> apparaÃ®t en haut Ã  gauche et permet de terminer la sÃ©lection par clic."
                   )),

                   p(HTML(
                       "Il est aussi possible de <b>tÃ©lÃ©charger</b> l'ensemble des fiches stations de <b>la sÃ©lection de stations</b> prÃ©cÃ©demment rÃ©alisÃ© dans l'analyse en cliquant sur le bouton <b>SÃ©lection</b> mais aussi de <b>tÃ©lÃ©charger l'entiÃ¨retÃ© des fiches stations</b> disponible en cliquant sur le bouton <b>Toute</b>."
                   )),
                   )
    ),

#### 6.4.13. Page 13 _________________________________________________
    page_circle(n=13, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),
    
    hidden(
        fixedPanel(id="help13_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>M</b>"
                   )),
                   
                   p(HTML(
                       "M"
                   ))
                   )
    ),

#### 6.4.14. Page 14 _________________________________________________
    page_circle(n=14, leftBase=leftHelp, widthHelp=widthHelp,
                top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                dh=dhNavHelp),
    
    hidden(
        fixedPanel(id="help14_panel",
                   class="Panel card-text",
                   left=leftHelp, top=topHelp,
                   width=widthHelp, height="auto",
                   
                   h1(HTML(
                       "<b>INFORMATION</b>"
                   )),
                   
                   p(HTML(
                       "Le logo <b>INRAE</b> en bas Ã  droite de l'interface est un bouton cliquable qui permet d'<b>afficher des informations</b>. Il est mentionnÃ© les <b>noms du dÃ©veloppeur</b> et du <b>rÃ©fÃ©rent INRAE</b> sous forme de liens vers leur <b>adresse email</b>. La troisiÃ¨me ligne renseigne sur l'<b>hÃ©bergeur SK8</b> et la derniÃ¨re ligne donne un lien vers le site qui Ã  donnÃ© l'<b>inspiration de l'interface</b>."
                   ))
                   )
        ),

#### 6.4.x. Nave button ______________________________________________
    hidden(
        fixedPanel(id="before_panelButton",
                   left=paste0("calc(", leftHelp,
                               " - ", 0.5*widthHelp, "px",
                               " - ", dhNavHelp, "px)"),
                   top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                   width="auto", height="auto",
                   Button(class="Button-icon",
                          inputId='before_button',
                          label=NULL,
                          icon_name=iconLib$navigate_before_white)
                   )
    ),


    hidden(
        fixedPanel(id="next_panelButton",
                   left=paste0("calc(", leftHelp,
                               " - ", 0.5*widthHelp, "px",
                               " + ", dhNavHelp*N_helpPage, "px)"),
                   top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                   width="auto", height="auto",
                   Button(class="Button-icon",
                          inputId='next_button',
                          label=NULL,
                          icon_name=iconLib$navigate_next_white)
                   )
    ),

    hidden(
        fixedPanel(id='closeHelp_panelButton',
                   left=paste0("calc(", leftHelp,
                               " - ", 0.5*widthHelp, "px",
                               " + ", dhNavHelp*(N_helpPage+1), "px)"),
                   top=paste0("calc(", topHelp, " + ", dyNavHelp, "px)"),
                   width="auto", height="auto",
                   Button(class="Button-icon",
                          inputId='closeHelp_button',
                          label=NULL,
                          icon_name=iconLib$close_white,
                          tooltip=word("tt.help.close")) 
                   )
    ),
    

    )
